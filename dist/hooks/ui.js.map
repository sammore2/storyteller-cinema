{"version":3,"file":"ui.js","sources":["../../src/components/ViewModeSelect.svelte","../../src/scripts/hooks/ui.js"],"sourcesContent":["<script>\r\n  export let scene;\r\n\r\n  // Inicializa o estado com o valor atual da flag ou padr√£o 'battlemap'\r\n  let viewMode = scene.getFlag(\"storyteller-cinema\", \"viewMode\") || \"battlemap\";\r\n\r\n  /**\r\n   * Atualiza a flag quando o valor do select muda.\r\n   */\r\n  async function updateViewMode(event) {\r\n    viewMode = event.target.value;\r\n    await scene.setFlag(\"storyteller-cinema\", \"viewMode\", viewMode);\r\n    console.log(`Storyteller Cinema | üé¨ View Mode set to: ${viewMode}`);\r\n  }\r\n</script>\r\n\r\n<div class=\"form-group\">\r\n  <label for=\"viewModeSelect\">Visualiza√ß√£o Padr√£o</label>\r\n  <div class=\"form-fields\">\r\n    <select id=\"viewModeSelect\" value={viewMode} on:change={updateViewMode}>\r\n      <option value=\"battlemap\">üìç Battlemap (T√°tico)</option>\r\n      <option value=\"cinematic\">üé¨ Cinematic (Imersivo)</option>\r\n    </select>\r\n  </div>\r\n  <p class=\"notes\">\r\n    Define se esta cena deve abrir automaticamente no Modo Cinem√°tico (Troca de\r\n    assets, Escala de Profundidade).\r\n  </p>\r\n</div>\r\n","import { toggleCinematicMode } from '../core/cinematic.js';\r\nimport ViewModeSelect from '../../components/ViewModeSelect.svelte';\r\n\r\nexport function registerUIHooks() {\r\n    Hooks.on('getSceneControlButtons', (controls) => {\r\n        // PROTE√á√ÉO: Normaliza controls\r\n        const controlList = Array.isArray(controls) ? controls : Object.values(controls);\r\n\r\n        const tokenLayer = controlList.find(c => c.name === 'token');\r\n        if (tokenLayer && tokenLayer.tools) {\r\n            // Evita duplicatas\r\n            if (!tokenLayer.tools.some(t => t.name === 'cinematic')) {\r\n                tokenLayer.tools.push({\r\n                    name: 'cinematic',\r\n                    title: 'Modo Cinema 2.5D',\r\n                    icon: 'fas fa-film',\r\n                    toggle: true,\r\n                    active: document.body.classList.contains('cinematic-mode'),\r\n                    onClick: async (tog) => await toggleCinematicMode(tog)\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    Hooks.on('renderSceneConfig', (app, html) => {\r\n        const scene = app.document ?? app.object;\r\n        if (!scene) return;\r\n\r\n        // PROTE√á√ÉO: V12+ usa HTMLElement, V11- usava JQuery\r\n        let root = html;\r\n        if (html.jquery) root = html[0];\r\n\r\n        if (!(root instanceof HTMLElement)) return;\r\n\r\n        // Procura bot√£o submit de forma nativa e segura\r\n        const submitBtn = root.querySelector('button[type=\"submit\"]');\r\n\r\n        if (submitBtn) {\r\n            // Evita inje√ß√£o duplicada\r\n            if (root.querySelector('.storyteller-cinema-mount')) return;\r\n\r\n            const mountPoint = document.createElement('div');\r\n            mountPoint.className = 'form-group storyteller-cinema-mount';\r\n            submitBtn.parentElement.insertBefore(mountPoint, submitBtn); // Insert before submit\r\n\r\n            new ViewModeSelect({ target: mountPoint, props: { scene } });\r\n        }\r\n    });\r\n}\r\n"],"names":["ctx"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,aAYM,QAAA,MAAA,MAAA;AAXJ,aAAuD,MAAA,KAAA;;AACvD,aAKM,MAAA,IAAA;AAJJ,aAGS,MAAA,MAAA;AAFP,aAAwD,QAAA,OAAA;AACxD,aAA0D,QAAA,OAAA;;;;QAFzB,IAAQ,CAAA;AAAA,MAAA;;AAK7C,aAGI,MAAA,CAAA;;;;;;UARsD,IAAc,CAAA;AAAA,QAAA;;;;;;;;;;UAAnCA,KAAQ,CAAA;AAAA,QAAA;AAAA;;;;;;;;;;;;;;QAlBlC,MAAK,IAAA;MAGZ,WAAW,MAAM,QAAQ,sBAAsB,UAAU,KAAK;AAKnD,iBAAA,eAAe,OAAK;AACjC,iBAAA,GAAA,WAAW,MAAM,OAAO,KAAK;AACvB,UAAA,MAAM,QAAQ,sBAAsB,YAAY,QAAQ;AAC9D,YAAQ,IAAG,6CAA8C,QAAQ,EAAA;AAAA;;;;;;;;;;;;ACT9D,SAAS,kBAAkB;AAC9B,QAAM,GAAG,0BAA0B,CAAC,aAAa;AAE7C,UAAM,cAAc,MAAM,QAAQ,QAAQ,IAAI,WAAW,OAAO,OAAO,QAAQ;AAE/E,UAAM,aAAa,YAAY,KAAK,OAAK,EAAE,SAAS,OAAO;AAC3D,QAAI,cAAc,WAAW,OAAO;AAEhC,UAAI,CAAC,WAAW,MAAM,KAAK,OAAK,EAAE,SAAS,WAAW,GAAG;AACrD,mBAAW,MAAM,KAAK;AAAA,UAClB,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,UACN,QAAQ;AAAA,UACR,QAAQ,SAAS,KAAK,UAAU,SAAS,gBAAgB;AAAA,UACzD,SAAS,OAAO,QAAQ,MAAM,oBAAoB,GAAG;AAAA,QACzE,CAAiB;AAAA,MACL;AAAA,IACJ;AAAA,EACJ,CAAC;AAED,QAAM,GAAG,qBAAqB,CAAC,KAAK,SAAS;AACzC,UAAM,QAAQ,IAAI,YAAY,IAAI;AAClC,QAAI,CAAC,MAAO;AAGZ,QAAI,OAAO;AACX,QAAI,KAAK,OAAQ,QAAO,KAAK,CAAC;AAE9B,QAAI,EAAE,gBAAgB,aAAc;AAGpC,UAAM,YAAY,KAAK,cAAc,uBAAuB;AAE5D,QAAI,WAAW;AAEX,UAAI,KAAK,cAAc,2BAA2B,EAAG;AAErD,YAAM,aAAa,SAAS,cAAc,KAAK;AAC/C,iBAAW,YAAY;AACvB,gBAAU,cAAc,aAAa,YAAY,SAAS;AAE1D,UAAI,eAAe,EAAE,QAAQ,YAAY,OAAO,EAAE,MAAK,EAAE,CAAE;AAAA,IAC/D;AAAA,EACJ,CAAC;AACL;"}