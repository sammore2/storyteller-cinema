{"version":3,"file":"cinematic.js","sources":["../../src/scripts/core/cinematic.js"],"sourcesContent":["import { applyVisualDepth } from './depth.js';\r\n\r\nexport function createOverlay() {\r\n    if (document.getElementById('storyteller-cinema-overlay')) return;\r\n    const overlay = document.createElement('div');\r\n    overlay.id = 'storyteller-cinema-overlay';\r\n    overlay.innerHTML = '<div class=\"cinematic-bar top\"></div><div class=\"cinematic-bar bottom\"></div>';\r\n    document.body.appendChild(overlay);\r\n}\r\n\r\nexport async function toggleCinematicMode(active) {\r\n    const overlay = document.getElementById('storyteller-cinema-overlay');\r\n\r\n    if (active) {\r\n        // --- ATIVAR ---\r\n        if (overlay) overlay.classList.add('active');\r\n        document.body.classList.add('cinematic-mode');\r\n        console.log(\"Storyteller Cinema | üü¢ Visual Novel Mode ON\");\r\n\r\n        // Aplica efeito inicial em todos os tokens\r\n        canvas.tokens.placeables.forEach(token => {\r\n            applyVisualDepth(token);\r\n        });\r\n\r\n    } else {\r\n        // --- DESATIVAR (HARD RESET) ---\r\n        if (overlay) overlay.classList.remove('active');\r\n        document.body.classList.remove('cinematic-mode');\r\n        console.log(\"Storyteller Cinema | üî¥ Visual Novel Mode OFF\");\r\n\r\n        // Restaura todos os tokens para o estado Original (Battlemap)\r\n        if (canvas.tokens) {\r\n            canvas.tokens.placeables.forEach(token => {\r\n                if (token.mesh && token.document) {\r\n                    // Hard Reset: Volta para os dados do Documento\r\n                    token.mesh.scale.set(token.document.texture.scaleX, token.document.texture.scaleY);\r\n\r\n                    // IMPORTANTE: Rota√ß√£o em Radianos (Foundry DB = Graus, PIXI = Radianos)\r\n                    token.mesh.rotation = Math.toRadians(token.document.rotation);\r\n\r\n                    token.mesh.alpha = token.document.hidden ? 0.5 : 1;\r\n\r\n                    // For√ßa redesenho para garantir que mudan√ßas de cor/borda voltem\r\n                    token.refresh();\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";AAEO,SAAS,gBAAgB;AAC5B,MAAI,SAAS,eAAe,4BAA4B,EAAG;AAC3D,QAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,UAAQ,KAAK;AACb,UAAQ,YAAY;AACpB,WAAS,KAAK,YAAY,OAAO;AACrC;AAEO,eAAe,oBAAoB,QAAQ;AAC9C,QAAM,UAAU,SAAS,eAAe,4BAA4B;AAEpE,MAAI,QAAQ;AAER,QAAI,QAAS,SAAQ,UAAU,IAAI,QAAQ;AAC3C,aAAS,KAAK,UAAU,IAAI,gBAAgB;AAC5C,YAAQ,IAAI,8CAA8C;AAG1D,WAAO,OAAO,WAAW,QAAQ,WAAS;AACtC,uBAAiB,KAAK;AAAA,IAC1B,CAAC;AAAA,EAEL,OAAO;AAEH,QAAI,QAAS,SAAQ,UAAU,OAAO,QAAQ;AAC9C,aAAS,KAAK,UAAU,OAAO,gBAAgB;AAC/C,YAAQ,IAAI,+CAA+C;AAG3D,QAAI,OAAO,QAAQ;AACf,aAAO,OAAO,WAAW,QAAQ,WAAS;AACtC,YAAI,MAAM,QAAQ,MAAM,UAAU;AAE9B,gBAAM,KAAK,MAAM,IAAI,MAAM,SAAS,QAAQ,QAAQ,MAAM,SAAS,QAAQ,MAAM;AAGjF,gBAAM,KAAK,WAAW,KAAK,UAAU,MAAM,SAAS,QAAQ;AAE5D,gBAAM,KAAK,QAAQ,MAAM,SAAS,SAAS,MAAM;AAGjD,gBAAM,QAAO;AAAA,QACjB;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,EACJ;AACJ;"}