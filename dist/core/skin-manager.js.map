{"version":3,"file":"skin-manager.js","sources":["../../src/scripts/core/skin-manager.js"],"sourcesContent":["export class SkinManager {\r\n    constructor() {\r\n        this.skins = new Map();\r\n        this.activeSkin = 'default';\r\n        this._styleTag = null;\r\n    }\r\n\r\n    init() {\r\n        console.log(\"Storyteller Cinema | Initializing Skin Manager...\");\r\n        this._createStyleTag();\r\n        this._registerDefaultSkins();\r\n\r\n        // Load saved skin setting\r\n        const savedSkin = game.settings.get('storyteller-cinema', 'activeSkin') || 'default';\r\n        this.apply(savedSkin);\r\n    }\r\n\r\n    /**\r\n     * Registers a new skin definition\r\n     * @param {Object} skinData The skin definition object\r\n     */\r\n    register(skinData) {\r\n        if (!skinData.id) {\r\n            console.error(\"Storyteller Cinema | Skin missing ID:\", skinData);\r\n            return;\r\n        }\r\n        this.skins.set(skinData.id, skinData);\r\n        console.log(`Storyteller Cinema | Skin Registered: ${skinData.name} (${skinData.id})`);\r\n    }\r\n\r\n    /**\r\n     * Applies a skin by ID\r\n     * @param {string} skinId \r\n     */\r\n    async apply(skinId) {\r\n        if (!this.skins.has(skinId)) {\r\n            console.warn(`Storyteller Cinema | Skin '${skinId}' not found. Reverting to default.`);\r\n            skinId = 'default';\r\n        }\r\n\r\n        const skin = this.skins.get(skinId);\r\n        this.activeSkin = skinId;\r\n\r\n        // 1. Update Body Class\r\n        // Remove old skin classes\r\n        const classes = document.body.className.split(\" \").filter(c => !c.startsWith(\"cinematic-skin-\"));\r\n        document.body.className = classes.join(\" \");\r\n        // Add new class\r\n        document.body.classList.add(`cinematic-skin-${skinId}`);\r\n        document.body.dataset.cinematicSkin = skinId;\r\n\r\n        // 2. Inject CSS Variables\r\n        this._injectCSS(skin);\r\n\r\n        // 3. Save Setting\r\n        if (game.settings.get('storyteller-cinema', 'activeSkin') !== skinId) {\r\n            await game.settings.set('storyteller-cinema', 'activeSkin', skinId);\r\n        }\r\n\r\n        console.log(`Storyteller Cinema | Applied Skin: ${skin.name}`);\r\n    }\r\n\r\n    getSkins() {\r\n        return Array.from(this.skins.values());\r\n    }\r\n\r\n    /* ---------------------------------------------------------------------- */\r\n    /* INTERNALS                                                              */\r\n    /* ---------------------------------------------------------------------- */\r\n\r\n    _createStyleTag() {\r\n        if (!document.getElementById('storyteller-cinema-skin-styles')) {\r\n            this._styleTag = document.createElement('style');\r\n            this._styleTag.id = 'storyteller-cinema-skin-styles';\r\n            document.head.appendChild(this._styleTag);\r\n        } else {\r\n            this._styleTag = document.getElementById('storyteller-cinema-skin-styles');\r\n        }\r\n    }\r\n\r\n    _injectCSS(skin) {\r\n        if (!this._styleTag) this._createStyleTag();\r\n\r\n        let css = `:root { \\n`;\r\n\r\n        // Styles\r\n        if (skin.options.styles) {\r\n            for (const [key, value] of Object.entries(skin.options.styles)) {\r\n                css += `    ${key}: ${value};\\n`;\r\n            }\r\n        }\r\n\r\n        // Filters (Global)\r\n        if (skin.options.filter) {\r\n            css += `    --cinematic-filter: ${skin.options.filter};\\n`;\r\n        } else {\r\n            css += `    --cinematic-filter: none;\\n`;\r\n        }\r\n\r\n        // Backgrounds\r\n        if (skin.options.backgroundTexture) {\r\n            css += `    --cinematic-bg-texture: url('${skin.options.backgroundTexture}');\\n`;\r\n        } else {\r\n            css += `    --cinematic-bg-texture: none;\\n`;\r\n        }\r\n\r\n        css += `}\\n`;\r\n\r\n        // Apply Filter specifically to the scene container or body if needed\r\n        // Assuming style.scss uses var(--cinematic-filter)\r\n\r\n        this._styleTag.innerHTML = css;\r\n    }\r\n\r\n    _registerDefaultSkins() {\r\n        // 1. DEFAULT\r\n        this.register({\r\n            id: 'default',\r\n            name: 'Classic Black',\r\n            author: 'Storyteller',\r\n            version: '1.0.0',\r\n            options: {\r\n                theme: 'dark',\r\n                styles: {\r\n                    '--cinematic-bar-bg': '#000000',\r\n                    '--cinematic-bar-border': 'none',\r\n                    '--cinematic-text-color': '#ffffff'\r\n                }\r\n            }\r\n        });\r\n\r\n        // 2. VIGNETTE\r\n        this.register({\r\n            id: 'vignette',\r\n            name: 'Soft Vignette',\r\n            author: 'Storyteller',\r\n            version: '1.0.0',\r\n            options: {\r\n                theme: 'dark',\r\n                styles: {\r\n                    '--cinematic-bar-bg': 'linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.8) 50%, transparent 100%)',\r\n                    '--cinematic-bar-border': 'none',\r\n                    '--cinematic-text-color': '#e0e0e0'\r\n                }\r\n            }\r\n        });\r\n\r\n        // 3. NOIR\r\n        this.register({\r\n            id: 'noir',\r\n            name: 'Noir Detective',\r\n            author: 'Storyteller',\r\n            version: '1.0.0',\r\n            options: {\r\n                theme: 'dark',\r\n                filter: 'grayscale(100%) contrast(1.2)',\r\n                styles: {\r\n                    '--cinematic-bar-bg': '#1a1a1a',\r\n                    '--cinematic-bar-border': '1px solid #333',\r\n                    '--cinematic-text-color': '#cccccc'\r\n                }\r\n            }\r\n        });\r\n\r\n        // 4. SEPIA\r\n        this.register({\r\n            id: 'sepia',\r\n            name: 'Old Photograph',\r\n            author: 'Storyteller',\r\n            version: '1.0.0',\r\n            options: {\r\n                theme: 'light',\r\n                filter: 'sepia(0.8) contrast(0.9)',\r\n                styles: {\r\n                    '--cinematic-bar-bg': '#3b2f2f',\r\n                    '--cinematic-bar-border': '2px solid #8b7355',\r\n                    '--cinematic-text-color': '#f4ebd0'\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}