{"version":3,"file":"main.js","sources":["../src/scripts/main.js"],"sourcesContent":["import '../styles/style.scss';\r\nimport { registerInitHooks } from './hooks/init.js';\r\nimport { registerUIHooks } from './hooks/ui.js';\r\n// import { applyVisualDepth } from './core/depth.js'; // REMOVIDO PARA CLEANUP\r\nimport { toggleCinematicMode } from './core/cinematic.js';\r\n\r\n// =============================================================================\r\n// Entry Point: Registration\r\n// =============================================================================\r\n\r\nregisterInitHooks();\r\nregisterUIHooks();\r\n\r\n// =============================================================================\r\n// Reactive Hooks (Proxy Logic)\r\n// =============================================================================\r\n\r\nimport { ProxyManager } from './core/proxy.js';\r\n\r\nHooks.on('refreshToken', (token) => {\r\n  // Se estiver em modo cinema, atualiza o proxy correspondente\r\n  if (document.body.classList.contains('cinematic-mode')) {\r\n    ProxyManager.update(token);\r\n  }\r\n});\r\n\r\nHooks.on('canvasReady', async (canvas) => {\r\n  const scene = canvas.scene;\r\n  if (!scene) return;\r\n\r\n  const shouldActivate = scene.getFlag('storyteller-cinema', 'viewMode') === 'cinematic';\r\n  if (shouldActivate) {\r\n    // Safe wait loop\r\n    let maxTries = 20;\r\n    while (canvas.tokens?.placeables?.length === 0 && maxTries > 0) {\r\n      await new Promise(r => setTimeout(r, 100));\r\n      maxTries--;\r\n    }\r\n  }\r\n  await toggleCinematicMode(shouldActivate);\r\n});\r\n\r\nHooks.on('updateScene', (scene, data) => {\r\n  // Apenas se for a cena ativa\r\n  if (!canvas.ready || scene.id !== canvas.scene?.id) return;\r\n\r\n  // Verifica se a flag de viewMode mudou\r\n  if (data.flags && data.flags['storyteller-cinema'] && data.flags['storyteller-cinema'].viewMode !== undefined) {\r\n    const newMode = data.flags['storyteller-cinema'].viewMode;\r\n    toggleCinematicMode(newMode === 'cinematic');\r\n  }\r\n});\r\n\r\nHooks.on('createToken', (tokenDoc) => {\r\n  if (document.body.classList.contains('cinematic-mode')) {\r\n    setTimeout(() => { if (tokenDoc.object) tokenDoc.object.refresh() }, 100);\r\n  }\r\n});\r\n"],"names":["canvas"],"mappings":";;;;AAUA;AACA;AAQA,MAAM,GAAG,gBAAgB,CAAC,UAAU;AAElC,MAAI,SAAS,KAAK,UAAU,SAAS,gBAAgB,GAAG;AACtD,iBAAa,OAAO,KAAK;AAAA,EAC3B;AACF,CAAC;AAED,MAAM,GAAG,eAAe,OAAOA,YAAW;;AACxC,QAAM,QAAQA,QAAO;AACrB,MAAI,CAAC,MAAO;AAEZ,QAAM,iBAAiB,MAAM,QAAQ,sBAAsB,UAAU,MAAM;AAC3E,MAAI,gBAAgB;AAElB,QAAI,WAAW;AACf,aAAO,WAAAA,QAAO,WAAP,mBAAe,eAAf,mBAA2B,YAAW,KAAK,WAAW,GAAG;AAC9D,YAAM,IAAI,QAAQ,OAAK,WAAW,GAAG,GAAG,CAAC;AACzC;AAAA,IACF;AAAA,EACF;AACA,QAAM,oBAAoB,cAAc;AAC1C,CAAC;AAED,MAAM,GAAG,eAAe,CAAC,OAAO,SAAS;;AAEvC,MAAI,CAAC,OAAO,SAAS,MAAM,SAAO,YAAO,UAAP,mBAAc,IAAI;AAGpD,MAAI,KAAK,SAAS,KAAK,MAAM,oBAAoB,KAAK,KAAK,MAAM,oBAAoB,EAAE,aAAa,QAAW;AAC7G,UAAM,UAAU,KAAK,MAAM,oBAAoB,EAAE;AACjD,wBAAoB,YAAY,WAAW;AAAA,EAC7C;AACF,CAAC;AAED,MAAM,GAAG,eAAe,CAAC,aAAa;AACpC,MAAI,SAAS,KAAK,UAAU,SAAS,gBAAgB,GAAG;AACtD,eAAW,MAAM;AAAE,UAAI,SAAS,OAAQ,UAAS,OAAO,QAAO;AAAA,IAAG,GAAG,GAAG;AAAA,EAC1E;AACF,CAAC;"}