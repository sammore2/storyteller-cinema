{"version":3,"file":"main.js","sources":["../src/scripts/main.js"],"sourcesContent":["import '../styles/style.scss';\r\nimport { registerInitHooks } from './hooks/init.js';\r\nimport { registerUIHooks } from './hooks/ui.js';\r\nimport { applyVisualDepth } from './core/depth.js'; // VOLTOU\r\nimport { toggleCinematicMode } from './core/cinematic.js';\r\n\r\n// =============================================================================\r\n// Entry Point: Registration\r\n// =============================================================================\r\n\r\nregisterInitHooks();\r\nregisterUIHooks();\r\n\r\n// =============================================================================\r\n// Reactive Hooks (Interactive Visual Novel Logic)\r\n// =============================================================================\r\n\r\n// Hook principal de atualização visual (Animação/Movimento)\r\nHooks.on('refreshToken', (token) => {\r\n  // Se estiver em modo cinema, aplica a matemática de profundidade\r\n  if (document.body.classList.contains('cinematic-mode')) {\r\n    applyVisualDepth(token);\r\n  }\r\n});\r\n\r\nHooks.on('canvasReady', async (canvas) => {\r\n  const scene = canvas.scene;\r\n  if (!scene) return;\r\n\r\n  const shouldActivate = scene.getFlag('storyteller-cinema', 'viewMode') === 'cinematic';\r\n\r\n  // Espera tokens carregarem se necessário\r\n  if (shouldActivate) {\r\n    let maxTries = 20;\r\n    while (canvas.tokens?.placeables?.length === 0 && maxTries > 0) {\r\n      await new Promise(r => setTimeout(r, 100));\r\n      maxTries--;\r\n    }\r\n  }\r\n\r\n  await toggleCinematicMode(shouldActivate);\r\n});\r\n\r\nHooks.on('updateScene', (scene, data) => {\r\n  if (!canvas.ready || scene.id !== canvas.scene?.id) return;\r\n\r\n  if (data.flags && data.flags['storyteller-cinema'] && data.flags['storyteller-cinema'].viewMode !== undefined) {\r\n    const newMode = data.flags['storyteller-cinema'].viewMode;\r\n    toggleCinematicMode(newMode === 'cinematic');\r\n  }\r\n});\r\n\r\n// Suporte a Novos Tokens (Drop)\r\nHooks.on('createToken', (tokenDoc) => {\r\n  if (document.body.classList.contains('cinematic-mode')) {\r\n    // Dá um tempinho para o objeto ser criado e aplica o visual\r\n    setTimeout(() => {\r\n      if (tokenDoc.object) applyVisualDepth(tokenDoc.object);\r\n    }, 50);\r\n  }\r\n});\r\n"],"names":["canvas"],"mappings":";;;;AAUA;AACA;AAOA,MAAM,GAAG,gBAAgB,CAAC,UAAU;AAElC,MAAI,SAAS,KAAK,UAAU,SAAS,gBAAgB,GAAG;AACtD,qBAAiB,KAAK;AAAA,EACxB;AACF,CAAC;AAED,MAAM,GAAG,eAAe,OAAOA,YAAW;;AACxC,QAAM,QAAQA,QAAO;AACrB,MAAI,CAAC,MAAO;AAEZ,QAAM,iBAAiB,MAAM,QAAQ,sBAAsB,UAAU,MAAM;AAG3E,MAAI,gBAAgB;AAClB,QAAI,WAAW;AACf,aAAO,WAAAA,QAAO,WAAP,mBAAe,eAAf,mBAA2B,YAAW,KAAK,WAAW,GAAG;AAC9D,YAAM,IAAI,QAAQ,OAAK,WAAW,GAAG,GAAG,CAAC;AACzC;AAAA,IACF;AAAA,EACF;AAEA,QAAM,oBAAoB,cAAc;AAC1C,CAAC;AAED,MAAM,GAAG,eAAe,CAAC,OAAO,SAAS;;AACvC,MAAI,CAAC,OAAO,SAAS,MAAM,SAAO,YAAO,UAAP,mBAAc,IAAI;AAEpD,MAAI,KAAK,SAAS,KAAK,MAAM,oBAAoB,KAAK,KAAK,MAAM,oBAAoB,EAAE,aAAa,QAAW;AAC7G,UAAM,UAAU,KAAK,MAAM,oBAAoB,EAAE;AACjD,wBAAoB,YAAY,WAAW;AAAA,EAC7C;AACF,CAAC;AAGD,MAAM,GAAG,eAAe,CAAC,aAAa;AACpC,MAAI,SAAS,KAAK,UAAU,SAAS,gBAAgB,GAAG;AAEtD,eAAW,MAAM;AACf,UAAI,SAAS,OAAQ,kBAAiB,SAAS,MAAM;AAAA,IACvD,GAAG,EAAE;AAAA,EACP;AACF,CAAC;"}